---
title: "Company x: Half-Year Financial Report 2025"
output:
  flexdashboard::flex_dashboard:
    orientation: rows
    vertical_layout: fill
    self_contained: true
---

```{r setup, include=FALSE}
library(flexdashboard)
library(ggplot2)
library(dplyr)
library(tibble)
library(scales)
library(htmltools)


brand_purple      <- "#A68CFF"
brand_purple_dark <- "#8B5CF6"
brand_violet      <- "#7C3AED"
ink_900           <- "#0F172A"

theme_set(
theme_minimal(base_size = 12) +
theme(
plot.title    = element_text(face = "bold", colour = ink_900),
plot.subtitle = element_text(colour = "#475569"),
axis.title    = element_text(colour = "#475569"),
panel.grid.minor = element_blank()
)
)

fmt_eur_m <- function(x) prettyNum(x, big.mark = ",")

delta_badge <- function(cur, prev, ref = "vs Dec 31, 2024") {
d  <- cur - prev
p  <- ifelse(prev == 0, NA, d / prev)
arrow <- ifelse(d >= 0, "▲", "▼")
col   <- ifelse(d >= 0, "#16a34a", "#dc2626")  
HTML(sprintf(
"<span style='color:%s;'>%s %s (%s)</span> <span style='color:#64748B;'>%s</span>",
col, arrow, fmt_eur_m(abs(d)), percent(abs(p), accuracy = 0.1), ref
))
}

vb <- function(cur, prev, caption, icon){
valueBox(
value   = div(
span(style="font-size:6px; font-weight:100; color:#3B3B3B;", fmt_eur_m(cur)),
div(style="font-size:10px; margin-top:1px;", delta_badge(cur, prev))
),
caption = caption,
icon    = icon
)
}

```

```{r theme, echo=FALSE, results='asis'}

brand_purple      <- "#A68CFF"
brand_purple_dark <- "#8B5CF6"
brand_violet      <- "#7C3AED"
ink_900           <- "#0F172A"

purple_css <- "

.navbar, .navbar-default, .navbar-inverse {
  background: #8B5CF6 !important;
  border: none !important;
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}
.navbar .navbar-brand, .navbar .navbar-nav>li>a {
  color: #fff !important;
}

.value-box {
  padding: 6px 10px !important;     
  margin-bottom: 6px !important;     
  border-radius: 12px !important;
  min-height: 50px !important;      
}

.value-box {
  background: #F8F7FF !important;
  border: 1px solid #EEEAFE !important;
  border-radius: 14px;
  box-shadow: 0 6px 14px rgba(0,0,0,0.04);
}
.value-box .value   { color: #7C3AED !important; font-weight: 400; }
.value-box .caption { color: #0F172A !important; }
.value-box .icon i  { color: #A68CFF !important; opacity: .25; }


a, .glyphicon { color: #A68CFF; }
a:hover       { color: #8B5CF6; }


.chart-stage {
  background: #FFFFFF !important;
  border: 1px solid #EEEAFE;
  border-radius: 16px;
  box-shadow: 0 6px 14px rgba(86, 42, 255, 0.08); 
  padding: 16px 20px;
  margin: 4px 0 10px 0;
  transition: all 0.25s ease-in-out;
  min-height: 320px !important; 
}
.section.level3 {
  padding: 8px 10px !important; 
  margin-bottom: 10px;
}
"

htmltools::tags$style(htmltools::HTML(purple_css))

```


Row 
-----------------------------------------------------------------------

Column {data-width=25%}
-----------------------------------------------------------------------
### Total assets (€m)
```{r}
vb(124959, 132798, "Total assets (€m)", "fa-landmark")
```

Column {data-width=25%}
-----------------------------------------------------------------------

### Non-current assets (€m)
```{r}
vb(87942, 90210, "Non-current assets (€m)", "fa-gears")
```

Column {data-width=25%}
-----------------------------------------------------------------------

### Current assets (€m) 
```{r}
vb(37017, 42588, "Current assets (€m)", "fa-piggy-bank")

```

Column {data-width=25%}
-----------------------------------------------------------------------
### Cash & cash equivalents (€m) {data-height=90}

```{r}
vb(15359, 7441, "Cash & cash equivalents (€m)", "fa-money-bill-wave")
```


Row 
-----------------------------------------------------------------------

Column {data-width=25%}
-----------------------------------------------------------------------

### Balance Sheet Composition (H1 2025)

```{r}
bs <- tibble(
  side = c(rep("Assets", 3), rep("Liabilities", 3)),
  class = c("Assets: Current", "Assets: Non-current", "Assets: Intangibles",
            "Liabilities: Current", "Liabilities: Non-current", "Liabilities: Debt"),
  amt = c(37017, 87942, 20000, 19600, 17000, 10900)
)

ggplot(bs, aes(x = side, y = amt / 1000, fill = class)) +
  geom_col(width = .6) +
  scale_fill_manual(values = c(
    brand_purple, brand_purple_dark, brand_violet,
    "#C2B280", "#94A3B8", "#7E8695"
  )) +
  labs(title = "Balance Sheet Composition (H1 2025)", x = NULL, y = "€ billions") +
  theme(legend.position = "bottom")

```

### Insights 
```{r}
HTML(paste0(
"<b>Highlights</b><br/>",
"• Assets decreased by €7,839m (−5.9%) vs Dec-24.<br/>",
"• Cash increased to €15,359m (from €7,441m).<br/>",
"• Current assets fell (−€5,571m), partly offset by higher cash."
))
```
